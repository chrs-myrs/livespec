---
applies_to:
  - livespec_projects
criticality: IMPORTANT
failure_mode: Distribution pattern unclear causes duplication and drift between canonical and project copies
governed-by:
  - .livespec/standard/metaspecs/workspace.spec.md
derives-from:
  - specs/workspace/patterns.spec.md
---

# Distribution Pattern

## Requirements
- [!] LiveSpec distributes methodology through dist/ canonical source with symlinks for framework content and committed generated files for project-specific content.
  - dist/ contains canonical framework (source of truth)
  - dist/prompts/ - Canonical framework prompts
  - dist/templates/ - Canonical templates
  - dist/standard/ - MSL metaspecs and conventions
  - dist/guides/ - Usage guides
  - prompts/ - Symlinks to dist/prompts/* (no duplication)
  - prompts/generated/ - Project-specific generated prompts (committed)
  - .livespec/ - Copied from dist/ on project setup (gitignored)
  - Symlinks prevent drift between framework and project
  - Generated prompts customized to PURPOSE and specs

## Distribution Structure

### Canonical Source: dist/
- **dist/prompts/** - Canonical framework prompts (source of truth)
- **dist/templates/** - Canonical templates
- **dist/standard/** - MSL metaspecs and conventions
- **dist/guides/** - Usage guides

### Project Use: Symlinks + Generated
- **prompts/** - Symlinks to dist/prompts/* (easy access, no duplication)
- **prompts/generated/** - Project-specific generated prompts (committed)
  - Generated by: prompts/utils/generate-*.md
  - Examples: self-improve.md, internalise-learnings.md
  - Customized to project PURPOSE, principles, and spec structure
- **.livespec/** - Copied from dist/ on project setup (gitignored)

### Bootstrap AGENTS.md Pattern
- **dist/AGENTS.md** - Bootstrap version (minimal, ~5KB, instructs generation)
- **Project AGENTS.md** - Generated from workspace specs (30-40KB, routing)
- **Project ctxt/** - Generated sub-agent contexts (not distributed)
  - ctxt/phases/ - 5 phase specialists
  - ctxt/domains/ - Domain-specific patterns
  - ctxt/utils/ - 3 utility specialists
- **Generation**: Use `.livespec/prompts/utils/regenerate-contexts.md`
- **Timing**: Immediately after Phase 0 (workspace specs established)

**Bootstrap AGENTS.md content**:
- No frontmatter (clean agent context)
- Inline edit warning
- Summary of bootstrap purpose
- Instructions to regenerate full context tree
- Minimal essential rules (spec-first, MSL format)
- Path to Phase 0 for new projects

**Generated AGENTS.md + ctxt/ content**:
- Customized to project PURPOSE, domain, constraints
- Root AGENTS.md: Routing to specialized sub-agents
- Sub-agents: Phase/domain/utility specialists with proactive loading
- Total tree <150KB, typical loaded <60KB

## Why Symlinks

**Benefits:**
- Single source of truth (dist/ is canonical)
- No drift between prompts/ and dist/prompts/
- Updates to dist/ immediately visible in prompts/
- Clear separation: framework (symlinked) vs project-specific (generated/)

**Pattern:**
```bash
prompts/0-define/ -> ../dist/prompts/0-define/
prompts/1-design/ -> ../dist/prompts/1-design/
prompts/generated/ # Real directory with project-specific content
```

## Why Generated Prompts Are Committed

**Rationale:**
- Tailored to specific project context
- Reference actual PURPOSE.md and specs/
- Should be versioned with project
- Regenerated when project fundamentals change

**Examples:**
- prompts/generated/self-improve.md - Project-specific improvement analysis
- prompts/generated/internalise-learnings.md - Captures learnings in project specs

## Template Architecture Pattern

**Purpose:** Reusable markdown content for consistent agent guidance

**When to Create Template:**
- Content reused across multiple generated files
- Key process/checklist needing consistent application
- Content requiring independent updates without prompt changes

**Template Structure:**
- **Location**: `.livespec/templates/{domain}/` (e.g., `agents/`, `workspace/`)
- **Format**: Complete standalone markdown (not fragment)
- **Naming**: Descriptive (e.g., `pre-implementation-verification.md`)

**Template Flow:**
1. **Templates provide** reusable content (`.livespec/templates/agents/*.md`)
2. **Specs reference** templates (e.g., "Include `.livespec/templates/agents/X.md`")
3. **Prompts insert** templates during generation (e.g., "Insert template in START section")
4. **Generated files** are products (e.g., AGENTS.md includes template content)
5. **Distribution** via `dist/templates/` (target projects receive templates)

**Example:** Agent verification templates
- `templates/agents/pre-implementation-verification.md` - Checklist before implementing
- Referenced by: `specs/workspace/workspace-agent.spec.md`
- Inserted by: `prompts/4-evolve/4d-regenerate-agents.md`
- Result: AGENTS.md includes verification in START section

**Benefits:**
- Explicit and manageable (not embedded in prompts)
- Independently updatable (change template, regenerate)
- Distributable (templates copy to target projects)

## Reference Library Pattern

**Purpose**: Enable agents to navigate from AGENTS.md summary (80%) to deep detail (20%)

**Path convention**: Always use `.livespec/` prefix
- Works in livespec repo (`.livespec` → symlink to `dist/`)
- Works in target projects (`.livespec/` copied from `dist/`)
- Consistent across all environments

**Structure**:
- **Categories**: Conventions (how to structure), Metaspecs (spec types), Guides (how to apply)
- **Entry format**:
  - **Fetch when**: Action-oriented trigger conditions
  - **Provides**: What detail this reference contains
  - **Cross-ref**: Where in AGENTS.md this topic is summarized

**Example**:
```markdown
**Context Compression** - `.livespec/standard/conventions/context-compression.spec.md`
- **Fetch when**: Deciding inline vs extract, optimizing AGENTS.md size
- **Provides**: Full compression framework, decision criteria, extraction patterns
- **Cross-ref**: See "Context Compression" section for summary
```

**Location**: MIDDLE or END section of AGENTS.md (detailed navigation, not critical rules)

**Integration**: Cross-reference from AGENTS.md summary sections
```markdown
## Context Compression
[Brief summary]

**Framework reference**: See Reference Library: `context-compression.spec.md`
```

**Validation**:
- All `.livespec/` paths work in both livespec repo and target projects
- "Fetch when" conditions are action-oriented (not passive descriptions)
- Cross-references bidirectional (AGENTS.md ↔ Reference Library)
- Categories logical (Conventions, Metaspecs, Guides)

## Validation
- dist/ contains canonical framework source
- dist/AGENTS.md is bootstrap version (~5KB, instructs generation)
- prompts/ uses symlinks to dist/prompts/* (no duplication)
- prompts/generated/ contains project-specific content
- Generated prompts committed to version control
- .livespec/ copied from dist/ (gitignored in projects)
- Project AGENTS.md generated from workspace specs (after Phase 0)
- Project ctxt/ generated alongside AGENTS.md (not distributed)
- Templates follow structure and naming conventions
- Reference Library uses `.livespec/` prefix consistently
- No drift between framework and project copies
